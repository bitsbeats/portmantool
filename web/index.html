<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<title>Portmantool Web Interface</title>
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<h1>Portmantool</h1>
		<h2>Diff: expected/current</h2>
		<table>
			<thead>
				<tr>
					<th>Address</th>
					<th>Port</th>
					<th>Protocol</th>
					<th>Expected state</th>
					<th>Current state</th>
					<th>Last scanned</th>
					<th>Comment</th>
				</tr>
			</thead>
			<tbody id="target">
			</tbody>
		</table>
		<script src="main.js"></script>
		<script>
			const api = new Portmantool();
			const target = document.getElementById('target');

			const doUpdate = async () => {
				try {
					const diff = await api.get('diff');
					target.replaceChildren(...diff.map(data => {
						const tr = document.createElement('tr');
						tr.replaceChildren(...[
							'address',
							'port',
							'protocol',
							'expected_state',
							'actual_state',
							'scan_id',
							'comment',
						].map(property => {
							const td = document.createElement('td');
							td.innerText = data[property];

							return td;
						}));

						return tr;
					}));
				} catch (error) {
					console.log(error);
				}

				setTimeout(doUpdate, 5000);
			};

			doUpdate();
		</script>
	</body>
</html>
